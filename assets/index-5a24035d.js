import{d as s,E as e,h as r,l as o,N as i,v as t,i as a,y as l,O as m,n,s as d,w as u,P as c,o as g,u as p,p as h,k as _}from"./vendor-7f21fd24.js";import{h as v,c as F,r as w,a as y,_ as b}from"./index-52b3853e.js";Object.defineProperty,Object.getOwnPropertyDescriptor;let C=class{async getLogin(s){const{username:e,password:r,userEmail:o,smsCode:i}=s;return await v.post("/auth/login",{username:e,password:r,userEmail:o,smsCode:i})}async getSmsCode(s){return await v.post("/auth/verify-code",{email:s})}async getLogout(){return await v.post("/auth/logout")}async getRegister(s){const{username:e,password:r,email:o,smsCode:i,role:t}=s;return await v.post("/auth/register",{username:e,password:r,email:o,smsCode:i,role:t})}};C=((s,e,r,o)=>{for(var i,t=e,a=s.length-1;a>=0;a--)(i=s[a])&&(t=i(t)||t);return t})([F],C);const f=new C,x={getItem(s){const e=localStorage.getItem(s);if(e){const{value:r,expires:o}=JSON.parse(e);return!o||o>=Date.now()?r:(this.removeItem(s),null)}return null},setItem(s,e,r=86400){this.removeItem(s);const o=r&&Date.now()+1e3*r;localStorage.setItem(s,JSON.stringify({value:e,expires:o}))},removeItem(s){localStorage.removeItem(s)},clear(){localStorage.clear()}},S=s("user",{state:()=>({user:{}}),getters:{getUserId(){return this.user.id}},actions:{async userLogin(s){const{code:r,reason:o}=await f.getLogin(s);200===r?(await w.push("main"),x.setItem("userId",this.user.id)):e.error(o)}}})(),L={name:"LoginBox",data:()=>({isLogin:!0,loginForm:{username:"admin",email:"1960638223@qq.com",password:"123456789o",smsCode:"123456"},registerForm:{name:"adi",email:"1960638223@qq.com",password:"123456",smsCode:"123456",role:"man"},isLoding:!1,getSms:"获取验证码",errors:{username:"",email:"",password:"",smsCode:""},rules:{username:{required:!0,message:"请输入用户名"},email:{required:!0,type:"email",message:"请输入正确的邮箱地址"},password:{required:!0,message:"请输入密码"},smsCode:{required:!0,message:"请输入验证码"}}}),methods:{login(){S.userLogin(this.loginForm)},async register(){const s=y(f.getRegister.bind(f)),{code:e,reason:r}=await s(this.registerForm);200===e?(this.$message.success(r),this.$router.push("./main")):this.$message.error(r)},async getEmailSms(){if(this.isLoding)return;this.isLoding=!0;let s=60;this.getSms=`${s}s`;const e=setInterval((()=>{s--,this.getSms=`${s}s`,s<=0&&(clearInterval(e),this.getSms="获取验证码",this.isLoding=!1)}),1e3),r=y(f.getSmsCode.bind(f)),{code:o,reason:i,data:t}=await r(this.loginForm.email);200===o?this.$message.success(i):this.$message.error(i)},validateForm(){let s=!0;this.errors={};for(let e in this.rules)this.rules[e].required&&!this.loginForm[e]?(this.errors[e]=this.rules[e].message,s=!1):"email"!==this.rules[e].type||this.validateEmail(this.loginForm[e])||(this.errors[e]=this.rules[e].message,s=!1);return s},validateFormRegister(){let s=!0;this.errors={};for(let e in this.rules)this.rules[e].required&&!this.registerForm[e]?(this.errors[e]=this.rules[e].message,s=!1):"email"!==this.rules[e].type||this.validateEmail(this.registerForm[e])||(this.errors[e]=this.rules[e].message,s=!1);return s},validateEmail:s=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(s),submitForm(){this.validateForm()&&this.login()},submitFormRegister(){this.validateFormRegister()&&this.register()},isErrorShow(){this.isLogin=!this.isLogin,this.loginForm={username:"",email:"",password:"",smsCode:""},this.registerForm={name:"",email:"",password:""},this.errors={username:"",email:"",password:"",smsCode:""}}}},k=s=>(h("data-v-c7dc18db"),s=s(),_(),s),I={class:"main-box"},E=k((()=>o("h2",{class:"title"},"创建帐户",-1))),q=k((()=>o("span",{class:"text"},"或使用电子邮件进行注册",-1))),R={class:"input-box"},U={key:0,class:"error__message"},V={class:"input-box"},$={key:0,class:"error__message"},O={class:"input-box"},j={key:0,class:"error__message"},z={class:"sms-code"},A={key:0,class:"error__message"},D=k((()=>o("h2",{class:"title"},"登录网站",-1))),N=k((()=>o("span",{class:"text"},"或在左侧进行注册",-1))),P={class:"input-box"},Z={key:0,class:"error__message"},J={class:"input-box"},B={key:0,class:"error__message"},G={class:"input-box"},H={key:0,class:"error__message"},K={class:"sms-code"},M={key:0,class:"error__message"},Q=k((()=>o("div",{class:"switch__circle"},null,-1))),T=k((()=>o("div",{class:"switch__circle switch__circle_top"},null,-1))),W={class:"switch__container"},X=b(L,[["render",function(s,e){const h=c;return g(),r("div",I,[o("div",{class:n(["container","container-register",{"is-txl":s.isLogin}])},[o("form",{class:"register-form",onSubmit:e[9]||(e[9]=i(((...e)=>s.submitFormRegister&&s.submitFormRegister(...e)),["prevent"]))},[E,q,o("div",R,[s.errors.username?(g(),r("div",U,t(s.errors.username),1)):a("",!0),l(o("input",{class:n(["form__input",{input__error:s.errors.username}]),type:"text",placeholder:"用户名","onUpdate:modelValue":e[0]||(e[0]=e=>s.registerForm.username=e),onFocus:e[1]||(e[1]=e=>s.errors.username="")},null,34),[[m,s.registerForm.username]])]),o("div",V,[s.errors.email?(g(),r("div",$,t(s.errors.email),1)):a("",!0),l(o("input",{class:n(["form__input",{input__error:s.errors.email}]),type:"text",placeholder:"邮箱","onUpdate:modelValue":e[2]||(e[2]=e=>s.registerForm.email=e),onFocus:e[3]||(e[3]=e=>s.errors.email="")},null,34),[[m,s.registerForm.email]])]),o("div",O,[s.errors.password?(g(),r("div",j,t(s.errors.password),1)):a("",!0),l(o("input",{class:n(["form__input",{input__error:s.errors.password}]),type:"password",placeholder:"密码","onUpdate:modelValue":e[4]||(e[4]=e=>s.registerForm.password=e),onFocus:e[5]||(e[5]=e=>s.errors.password="")},null,34),[[m,s.registerForm.password]])]),o("div",z,[s.errors.smsCode?(g(),r("div",A,t(s.errors.smsCode),1)):a("",!0),l(o("input",{class:n(["form__input",{input__error:s.errors.smsCode}]),type:"text",placeholder:"验证码","onUpdate:modelValue":e[6]||(e[6]=e=>s.registerForm.smsCode=e),onFocus:e[7]||(e[7]=e=>s.errors.smsCode="")},null,34),[[m,s.registerForm.smsCode]]),d(h,{onClick:s.getEmailSms,disabled:s.isLoding,class:"primary-btn"},{default:u((()=>[p(t(s.getSms),1)])),_:1},8,["onClick","disabled"])]),o("div",{class:"primary-btn",onClick:e[8]||(e[8]=(...e)=>s.submitFormRegister&&s.submitFormRegister(...e))},"立即注册")],32)],2),o("div",{class:n(["container","container-login",{"is-txl is-z200":s.isLogin}])},[o("form",{class:"login-form",onSubmit:e[19]||(e[19]=i(((...e)=>s.submitForm&&s.submitForm(...e)),["prevent"]))},[D,N,o("div",P,[s.errors.username?(g(),r("div",Z,t(s.errors.username),1)):a("",!0),l(o("input",{class:n(["form__input",{input__error:s.errors.username}]),type:"text",placeholder:"用户名","onUpdate:modelValue":e[10]||(e[10]=e=>s.loginForm.username=e),onFocus:e[11]||(e[11]=e=>s.errors.username="")},null,34),[[m,s.loginForm.username]])]),o("div",J,[s.errors.email?(g(),r("div",B,t(s.errors.email),1)):a("",!0),l(o("input",{class:n(["form__input",{input__error:s.errors.email}]),type:"text",placeholder:"邮箱","onUpdate:modelValue":e[12]||(e[12]=e=>s.loginForm.email=e),onFocus:e[13]||(e[13]=e=>s.errors.email="")},null,34),[[m,s.loginForm.email]])]),o("div",G,[s.errors.password?(g(),r("div",H,t(s.errors.password),1)):a("",!0),l(o("input",{class:n(["form__input",{input__error:s.errors.password}]),type:"password",placeholder:"密码","onUpdate:modelValue":e[14]||(e[14]=e=>s.loginForm.password=e),onFocus:e[15]||(e[15]=e=>s.errors.password="")},null,34),[[m,s.loginForm.password]])]),o("div",K,[s.errors.smsCode?(g(),r("div",M,t(s.errors.smsCode),1)):a("",!0),l(o("input",{class:n(["form__input",{input__error:s.errors.smsCode}]),type:"text",placeholder:"验证码","onUpdate:modelValue":e[16]||(e[16]=e=>s.loginForm.smsCode=e),onFocus:e[17]||(e[17]=e=>s.errors.smsCode="")},null,34),[[m,s.loginForm.smsCode]]),d(h,{onClick:s.getEmailSms,disabled:s.isLoding,class:"primary-btn"},{default:u((()=>[p(t(s.getSms),1)])),_:1},8,["onClick","disabled"])]),o("div",{class:"primary-btn",onClick:e[18]||(e[18]=(...e)=>s.submitForm&&s.submitForm(...e))},"立即登录")],32)],2),o("div",{class:n(["switch",{login:s.isLogin}])},[Q,T,o("div",W,[o("h2",null,t(s.isLogin?"你好，陌生人 !":"欢迎回来 !"),1),o("p",null,t(s.isLogin?"输入您的个人详细信息并开始我们的旅程":"要与我们保持联系，请使用您的个人信息登录"),1),o("div",{class:"primary-btn",onClick:e[20]||(e[20]=(...e)=>s.isErrorShow&&s.isErrorShow(...e))},t(s.isLogin?"立即注册":"立即登录"),1)])],2)])}],["__scopeId","data-v-c7dc18db"]]);export{X as default};
